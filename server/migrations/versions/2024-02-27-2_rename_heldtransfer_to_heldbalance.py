"""Rename HeldTransfer to HeldBalance

Revision ID: eb5ad8374d1b
Revises: 6c44ca11198e
Create Date: 2024-02-21 14:28:48.523131

"""

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# Polar Custom Imports
from polar.kit.extensions.sqlalchemy import PostgresUUID

# revision identifiers, used by Alembic.
revision = "eb5ad8374d1b"
down_revision = "6c44ca11198e"
branch_labels: tuple[str] | None = None
depends_on: tuple[str] | None = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.rename_table("held_transfers", "held_balances")

    op.drop_column("held_balances", "properties")

    op.execute("ALTER INDEX held_transfers_pkey RENAME TO held_balances_pkey")
    op.execute(
        "ALTER INDEX ix_held_transfers_account_id RENAME TO ix_held_balances_account_id"
    )
    op.execute(
        "ALTER INDEX ix_held_transfers_subscription_id RENAME TO ix_held_balances_subscription_id"
    )
    op.execute(
        "ALTER INDEX ix_held_transfers_pledge_id RENAME TO ix_held_balances_pledge_id"
    )
    op.execute(
        "ALTER INDEX ix_held_transfers_payment_transaction_id RENAME TO ix_held_balances_payment_transaction_id"
    )
    op.execute(
        "ALTER INDEX ix_held_transfers_organization_id RENAME TO ix_held_balances_organization_id"
    )
    op.execute(
        "ALTER INDEX ix_held_transfers_issue_reward_id RENAME TO ix_held_balances_issue_reward_id"
    )
    op.execute(
        "ALTER TABLE held_balances RENAME CONSTRAINT held_transfers_subscription_id_fkey TO held_balances_subscription_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_balances RENAME CONSTRAINT held_transfers_pledge_id_fkey TO held_balances_pledge_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_balances RENAME CONSTRAINT held_transfers_payment_transaction_id_fkey TO held_balances_payment_transaction_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_balances RENAME CONSTRAINT held_transfers_organization_id_fkey TO held_balances_organization_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_balances RENAME CONSTRAINT held_transfers_issue_reward_id_fkey TO held_balances_issue_reward_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_balances RENAME CONSTRAINT held_transfers_account_id_fkey TO held_balances_account_id_fkey"
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.rename_table("held_balances", "held_transfers")

    op.add_column(
        "held_transfers",
        sa.Column(
            "properties",
            postgresql.JSONB(astext_type=sa.Text()),
            autoincrement=False,
            nullable=True,
        ),
    )

    op.execute("ALTER INDEX held_balances_pkey RENAME TO held_transfers_pkey")
    op.execute(
        "ALTER INDEX ix_held_balances_account_id RENAME TO ix_held_transfers_account_id"
    )
    op.execute(
        "ALTER INDEX ix_held_balances_subscription_id RENAME TO ix_held_transfers_subscription_id"
    )
    op.execute(
        "ALTER INDEX ix_held_balances_pledge_id RENAME TO ix_held_transfers_pledge_id"
    )
    op.execute(
        "ALTER INDEX ix_held_balances_payment_transaction_id RENAME TO ix_held_transfers_payment_transaction_id"
    )
    op.execute(
        "ALTER INDEX ix_held_balances_organization_id RENAME TO ix_held_transfers_organization_id"
    )
    op.execute(
        "ALTER INDEX ix_held_balances_issue_reward_id RENAME TO ix_held_transfers_issue_reward_id"
    )
    op.execute(
        "ALTER TABLE held_transfers RENAME CONSTRAINT held_balances_subscription_id_fkey TO held_transfers_subscription_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_transfers RENAME CONSTRAINT held_balances_pledge_id_fkey TO held_transfers_pledge_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_transfers RENAME CONSTRAINT held_balances_payment_transaction_id_fkey TO held_transfers_payment_transaction_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_transfers RENAME CONSTRAINT held_balances_organization_id_fkey TO held_transfers_organization_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_transfers RENAME CONSTRAINT held_balances_issue_reward_id_fkey TO held_transfers_issue_reward_id_fkey"
    )
    op.execute(
        "ALTER TABLE held_transfers RENAME CONSTRAINT held_balances_account_id_fkey TO held_transfers_account_id_fkey"
    )
    # ### end Alembic commands ###
