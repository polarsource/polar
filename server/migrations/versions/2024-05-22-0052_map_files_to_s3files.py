"""map files to s3files

Revision ID: 99bf7b2ba031
Revises: 850e3dd880b7
Create Date: 2024-05-22 00:52:11.874933

"""

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# Polar Custom Imports
from polar.kit.extensions.sqlalchemy import PostgresUUID

# revision identifiers, used by Alembic.
revision = "99bf7b2ba031"
down_revision = "850e3dd880b7"
branch_labels: tuple[str] | None = None
depends_on: tuple[str] | None = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column("files", "uploaded_at", new_column_name="last_modified_at")
    op.alter_column("files", "s3_version_id", new_column_name="storage_version")
    op.alter_column("files", "etag", new_column_name="checksum_etag")
    op.alter_column("files", "sha256_base64", new_column_name="checksum_sha256_base64")
    op.alter_column("files", "sha256_hex", new_column_name="checksum_sha256_hex")
    op.drop_column("files", "upload_id")
    op.drop_column("files", "presigned_at")
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column("files", "last_modified_at", new_column_name="uploaded_at")
    op.alter_column("files", "storage_version", new_column_name="s3_version_id")
    op.alter_column("files", "checksum_etag", new_column_name="etag")
    op.alter_column("files", "checksum_sha256_base64", new_column_name="sha256_base64")
    op.alter_column("files", "checksum_sha256_hex", new_column_name="sha256_hex")
    op.add_column(
        "files",
        sa.Column("upload_id", sa.VARCHAR(), autoincrement=False, nullable=True),
    )
    op.add_column(
        "files",
        sa.Column(
            "presigned_at",
            postgresql.TIMESTAMP(timezone=True),
            autoincrement=False,
            nullable=True,
        ),
    )
    # ### end Alembic commands ###
