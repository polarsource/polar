"""Rename Sale to Order

Revision ID: de1c70f1c536
Revises: fd463bc1e1ec
Create Date: 2024-05-27 09:14:27.219744

"""

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# Polar Custom Imports
from polar.kit.extensions.sqlalchemy import PostgresUUID

# revision identifiers, used by Alembic.
revision = "de1c70f1c536"
down_revision = "fd463bc1e1ec"
branch_labels: tuple[str] | None = None
depends_on: tuple[str] | None = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index("ix_sales_created_at", table_name="sales")
    op.drop_index("ix_sales_deleted_at", table_name="sales")
    op.drop_index("ix_sales_modified_at", table_name="sales")
    op.rename_table("sales", "orders")
    op.create_index(
        op.f("ix_orders_created_at"), "orders", ["created_at"], unique=False
    )
    op.create_index(
        op.f("ix_orders_deleted_at"), "orders", ["deleted_at"], unique=False
    )
    op.create_index(
        op.f("ix_orders_modified_at"), "orders", ["modified_at"], unique=False
    )

    op.alter_column("benefit_grants", "sale_id", new_column_name="order_id")
    op.drop_index("ix_benefit_grants_sale_id", table_name="benefit_grants")
    op.create_index(
        op.f("ix_benefit_grants_order_id"), "benefit_grants", ["order_id"], unique=False
    )
    op.drop_constraint(
        "benefit_grants_sale_id_fkey", "benefit_grants", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("benefit_grants_order_id_fkey"),
        "benefit_grants",
        "orders",
        ["order_id"],
        ["id"],
        ondelete="cascade",
    )

    op.alter_column("held_balances", "sale_id", new_column_name="order_id")
    op.drop_index("ix_held_balances_sale_id", table_name="held_balances")
    op.create_index(
        op.f("ix_held_balances_order_id"), "held_balances", ["order_id"], unique=False
    )
    op.drop_constraint(
        "held_balances_sale_id_fkey", "held_balances", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("held_balances_order_id_fkey"),
        "held_balances",
        "orders",
        ["order_id"],
        ["id"],
        ondelete="set null",
    )

    op.alter_column("transactions", "sale_id", new_column_name="order_id")
    op.drop_index("ix_transactions_sale_id", table_name="transactions")
    op.create_index(
        op.f("ix_transactions_order_id"), "transactions", ["order_id"], unique=False
    )
    op.drop_constraint("transactions_sale_id_fkey", "transactions", type_="foreignkey")
    op.create_foreign_key(
        op.f("transactions_order_id_fkey"),
        "transactions",
        "orders",
        ["order_id"],
        ["id"],
        ondelete="set null",
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("ix_orders_modified_at"), table_name="orders")
    op.drop_index(op.f("ix_orders_deleted_at"), table_name="orders")
    op.drop_index(op.f("ix_orders_created_at"), table_name="orders")

    op.rename_table("orders", "sales")

    op.create_index("ix_sales_modified_at", "sales", ["modified_at"], unique=False)
    op.create_index("ix_sales_deleted_at", "sales", ["deleted_at"], unique=False)
    op.create_index("ix_sales_created_at", "sales", ["created_at"], unique=False)

    op.alter_column("transactions", "order_id", new_column_name="sale_id")
    op.drop_constraint(
        op.f("transactions_order_id_fkey"), "transactions", type_="foreignkey"
    )
    op.create_foreign_key(
        "transactions_sale_id_fkey",
        "transactions",
        "sales",
        ["sale_id"],
        ["id"],
        ondelete="SET NULL",
    )
    op.drop_index(op.f("ix_transactions_order_id"), table_name="transactions")
    op.create_index(
        "ix_transactions_sale_id", "transactions", ["sale_id"], unique=False
    )

    op.alter_column("held_balances", "order_id", new_column_name="sale_id")
    op.drop_constraint(
        op.f("held_balances_order_id_fkey"), "held_balances", type_="foreignkey"
    )
    op.create_foreign_key(
        "held_balances_sale_id_fkey",
        "held_balances",
        "sales",
        ["sale_id"],
        ["id"],
        ondelete="SET NULL",
    )
    op.drop_index(op.f("ix_held_balances_order_id"), table_name="held_balances")
    op.create_index(
        "ix_held_balances_sale_id", "held_balances", ["sale_id"], unique=False
    )

    op.alter_column("benefit_grants", "order_id", new_column_name="sale_id")
    op.drop_constraint(
        op.f("benefit_grants_order_id_fkey"), "benefit_grants", type_="foreignkey"
    )
    op.create_foreign_key(
        "benefit_grants_sale_id_fkey",
        "benefit_grants",
        "sales",
        ["sale_id"],
        ["id"],
        ondelete="CASCADE",
    )
    op.drop_index(op.f("ix_benefit_grants_order_id"), table_name="benefit_grants")
    op.create_index(
        "ix_benefit_grants_sale_id", "benefit_grants", ["sale_id"], unique=False
    )
    # ### end Alembic commands ###
